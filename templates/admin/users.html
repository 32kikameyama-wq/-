{% extends 'layout.html' %}

{% block title %}ユーザー管理 - 案件管理システム{% endblock %}

{% block content %}
<div class="content-wrapper">
    <section>
        <h2>ユーザー管理</h2>
        <p>管理者が編集者・クライアントを登録すると、ベースの編集者ページを元に個別ページが自動生成される想定です。</p>

        {% if success %}
        <div class="alert success-message">{{ success }}</div>
        {% endif %}

        {% if error %}
        <div class="alert error-message">
            {% for line in error.split('\n') %}
            <div>{{ line }}</div>
            {% endfor %}
        </div>
        {% endif %}

        <div class="users-grid">
            <div class="user-list-card">
                <h3>登録済みユーザー</h3>
                <table class="users-table">
                    <thead>
                        <tr>
                            <th>ユーザー番号</th>
                            <th>氏名</th>
                            <th>メールアドレス</th>
                            <th>ロール</th>
                            <th>状態</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for user in users %}
                        <tr>
                            <td data-user-id="{{ user.id }}">{{ loop.index }}</td>
                            <td>{{ user.name }}</td>
                            <td>{{ user.email }}</td>
                            <td>{{ role_labels.get(user.role, user.role) }}</td>
                            <td>
                                {% if user.active %}
                                <span class="status-badge status-active">有効</span>
                                {% else %}
                                <span class="status-badge status-inactive">無効</span>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>

            <div class="user-form-card">
                <h3>新規ユーザー作成</h3>
                <form method="post" class="admin-user-form">
                    <div class="form-group">
                        <label for="name">氏名</label>
                        <input type="text" id="name" name="name" value="{{ form_data.get('name', '') }}" required>
                    </div>

                    <div class="form-group">
                        <label for="email">メールアドレス</label>
                        <input type="email" id="email" name="email" value="{{ form_data.get('email', '') }}" required>
                    </div>

                    <div class="form-group">
                        <label for="role">ロール</label>
                        <select id="role" name="role" required>
                            <option value="admin" {% if form_data.get('role') == 'admin' %}selected{% endif %}>管理者</option>
                            <option value="editor" {% if form_data.get('role', 'editor') == 'editor' %}selected{% endif %}>編集者</option>
                            <option value="client" {% if form_data.get('role') == 'client' %}selected{% endif %}>クライアント</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="password">初期パスワード</label>
                        <input type="password" id="password" name="password" placeholder="6文字以上" required>
                    </div>

                    <div class="form-group checkbox-group">
                        <label class="checkbox-label">
                            <input type="checkbox" name="active" {% if form_data.get('active', True) %}checked{% endif %}>
                            <span>有効化して登録する</span>
                        </label>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">ユーザーを作成</button>
                    </div>
                </form>
            </div>
        </div>
    </section>
</div>
{% endblock %}


