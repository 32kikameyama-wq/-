<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}編集者ポータル - 案件管理システム{% endblock %}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="{{ url_for('static', filename='js/project_form.js') }}" defer></script>
    {% block extra_scripts %}{% endblock %}
</head>
<body>
    <div class="app-container">
        <aside class="sidebar editor-sidebar">
            <div class="sidebar-header">
                <h1 class="logo">編集者ポータル</h1>
                <div class="user-info">
                    {% if current_user %}
                    <div class="user-info-primary">
                        <span class="user-name">{{ current_user.name }}</span>
                        {% if current_user_role_label %}
                        <span class="user-role">{{ current_user_role_label }}</span>
                        {% endif %}
                    </div>
                    {% if current_user.role == 'admin' %}
                    <a href="{{ url_for('index') }}" class="switch-link">→ 管理者画面へ</a>
                    {% endif %}
                    {% if current_user.role in ['admin', 'editor', 'client'] %}
                    <a href="{{ url_for('client_dashboard') }}" class="switch-link">→ クライアント画面へ</a>
                    {% endif %}
                    <form action="{{ url_for('logout') }}" method="post" class="user-menu-form">
                        <input type="hidden" name="next" value="{{ url_for('login') }}">
                        <button type="submit" class="logout-button">ログアウト</button>
                    </form>
                    {% else %}
                    <a href="{{ url_for('login') }}" class="switch-link">ログイン</a>
                    {% endif %}
                </div>
            </div>

            <nav class="sidebar-nav">
                <ul class="nav-list">
                    <li class="nav-item">
                        <a href="/editor" class="nav-link {% if request.endpoint == 'editor_dashboard' %}active{% endif %}">
                            <span class="nav-text">トップ</span>
                        </a>
                    </li>
                    <li class="nav-item nav-item-with-submenu">
                        <div class="nav-link-with-toggle" onclick="toggleSubmenu(this)">
                            <span class="nav-text">案件管理</span>
                            <span class="nav-toggle-icon">▼</span>
                        </div>
                        <ul class="nav-submenu {% if request.endpoint in ['editor_projects', 'editor_project_detail', 'editor_board', 'editor_assets', 'editor_gantt'] %}active{% endif %}" style="{% if request.endpoint in ['editor_projects', 'editor_project_detail', 'editor_board', 'editor_assets', 'editor_gantt'] %}display: block;{% else %}display: none;{% endif %}">
                            <li class="nav-subitem">
                                <a href="/editor/projects" class="nav-link {% if request.endpoint == 'editor_projects' %}active{% endif %}">
                                    <span class="nav-text">案件一覧</span>
                                </a>
                            </li>
                            <li class="nav-subitem">
                                <a href="/editor/board" class="nav-link {% if request.endpoint == 'editor_board' %}active{% endif %}">
                                    <span class="nav-text">案件ボード</span>
                                </a>
                            </li>
                            <li class="nav-subitem">
                                <a href="/editor/assets" class="nav-link {% if request.endpoint == 'editor_assets' %}active{% endif %}">
                                    <span class="nav-text">素材管理</span>
                                </a>
                            </li>
                            <li class="nav-subitem">
                                <a href="{{ url_for('editor_gantt') }}" class="nav-link {% if request.endpoint == 'editor_gantt' %}active{% endif %}">
                                    <span class="nav-text">ガントチャート</span>
                                </a>
                            </li>
                        </ul>
                    </li>
                    <li class="nav-item">
                        <a href="/editor/companies" class="nav-link {% if request.endpoint in ['editor_companies', 'editor_company_detail'] %}active{% endif %}">
                            <span class="nav-text">会社一覧</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="/editor/input-videos" class="nav-link {% if request.endpoint == 'editor_input_videos' %}active{% endif %}">
                            <span class="nav-text">編集インプット動画</span>
                        </a>
                    </li>
                </ul>
            </nav>

            <script>
            function toggleSubmenu(element) {
                event.preventDefault();
                event.stopPropagation();

                const submenu = element.nextElementSibling;
                const icon = element.querySelector('.nav-toggle-icon');

                if (submenu) {
                    const isActive = submenu.classList.contains('active');

                    document.querySelectorAll('.nav-submenu').forEach(menu => {
                        menu.classList.remove('active');
                        menu.style.display = 'none';
                    });

                    document.querySelectorAll('.nav-toggle-icon').forEach(toggleIcon => {
                        toggleIcon.textContent = '▼';
                    });

                    if (!isActive) {
                        submenu.classList.add('active');
                        submenu.style.display = 'block';
                        if (icon) {
                            icon.textContent = '▲';
                        }
                    } else {
                        submenu.classList.remove('active');
                        submenu.style.display = 'none';
                        if (icon) {
                            icon.textContent = '▼';
                        }
                    }
                }
            }

            document.addEventListener('DOMContentLoaded', function() {
                const activeSubmenu = document.querySelector('.nav-submenu.active');
                if (activeSubmenu) {
                    activeSubmenu.style.display = 'block';
                    const toggleIcon = activeSubmenu.previousElementSibling.querySelector('.nav-toggle-icon');
                    if (toggleIcon) {
                        toggleIcon.textContent = '▲';
                    }
                } else {
                    document.querySelectorAll('.nav-submenu').forEach(menu => {
                        menu.style.display = 'none';
                    });
                }
            });
            </script>
        </aside>

        <main class="main-content editor-main-content">
            {% block content %}{% endblock %}
        </main>
    </div>
</body>
</html>


